- [ ] 1、bailing65b 2048编译
```
python sparse_compile/example/compile_llm_from_hf_v2.py -o /home/dongbenyang/workspace/moffett_software/debug/debug6/case/20241012_moffett_llm_bailing65b_deliver_layer1_111111111  -wo /ssd3/hehuizhang/llm/weight/bailing/bailing_65B/ -hfmn /ssd3/hehuizhang/llm/weight/bailing/bailing_65B/ -cfg /home/dongbenyang/workspace/git_lab/moffett_software/.vscode/bailin65b_compile_config.json -cm tp serving
```


- [ ] 2、compile 编译 比较卡,debug找问题去优化
https://zhuanlan.zhihu.com/p/363434563
1. cProfile
    - 使用
```
python -m cProfile -o pipeline.prof macd_all_v1.py
pip install flameprof
flameprof pipeline.prof > pipeline.svg
python3 -m pstats /home/dongbenyang/workspace/git_lab/moffett_software/pipeline.prof
```
   - 介绍
```
cProfile 是一个 event based profiler，它的工作原理是追踪 Python 解释器上的每一个 Python 函数调用和时间开销。cProfile 是 Python 的 built-in profiler，理论上对 Python 的支持度相对较高。cProfile 的局限有很多：

只能观测纯 Python 的函数调用，无法看到 C/C++ 拓展的调用栈
只支持 wall clock time
overhead 相对较大
```

2. 
```
pip install py-spy
# 运行脚本分析
py-spy record --format speedscope -o output.json --native -- python3 xxx.py

# 根据进程号，对已经运行的脚本分析
# py-spy record --format speedscope -o output.json --native --pid 12345

主要参数:

    --format: 输出格式，默认是flamegraph，推荐使用speedscope格式
    --output: 输出文件名
    --native: 是否采样C/C++调用栈，不加--native只会对Python调用栈进行采样

其他参数
    --rate: 采样频率，默认值为100，打开--native会增大overhead，建议打开--native时调低--rate
    --subprocesses: 是否对子进程进行采样，默认为否
    --gil: 是否只对拿到Python GIL的线程进行采样# --threads: 在输出中显示thread id
    --idle: 是否对idle(即off-CPU time)的thread进行采样，默认为否，根据具体场景选择是否打开
```

py-spy record -sti --rate 1 --format speedscope --native -o output.json -- python3 xxx.py

```
    py-spy: 这是性能分析工具的名称。
    record: 这个子命令告诉 py-spy 要记录程序的执行情况，而不是实时显示。
    -s: 这个选项表示将生成的性能分析数据保存到一个文件中。
    -t: 这个选项表示在记录中包含线程信息。
    -i: 这个选项表示在记录中包含 Python 解释器的帧。
    --rate 10: 这设置了采样率为每秒10次。这意味着 py-spy 将每秒对正在运行的程序进行10次采样。
    --format speedscope: 这指定了输出文件的格式为 speedscope。Speedscope 是一个交互式的火焰图查看器。
    --native: 这个选项告诉 py-spy 也要采样本地/C扩展代码，而不仅仅是 Python 代码。
    -o output.json: 这指定了输出文件的名称为 output.json。
    --: 这个双破折号用来分隔 py-spy 的参数和要运行的 Python 程序的参数。
    python3 xxx.py: 这是要运行和分析的 Python 程序。
```

3. snakeviz
```
pip install snakeviz
python -m cProfile -o log.profile macd_all_v1.py
snakeviz -p 8080 log.profile
```


```
cProfile输出的各个参数分别代表以下信息：
    ncalls：函数调用的次数。
    tottime：该函数运行花费的总时间。
    percall：每次调用该函数的平均时间。
    cumtime：该函数及其所有子函数运行的总时间。
    filename:lineno(function)：表示函数所在的文件名、行号以及函数名。
```


- [ ] 3、opencompass评测结果查看
```
105：
(opencompass) moffett@runtime-dev-105:~/work/xuhuizou/project/opencompass/opencompass$ python run.py configs/eval_mftuili.py -r 20240806_093534 -w outputs/mftuili_moffett/

66：
/ssd1/xuhuizou/project/opencompass/mftuili_vllm/20240809_061538/results/MFTUILIChatAPI
```


