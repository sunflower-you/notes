- [ ] 1、复现 容器中 runtime 问题
1. bailing10b
```
ssh moffett@10.1.20.105

python3 /home/moffett/workspace/llm_compile/data/compile_llm_from_hf_v2.py -o ../llm_compile/data/20241010_bailing_10B_layer2 -wo /home/moffett/workspace/llm_compile/data/bailing_10B/ -hfmn /home/moffett/workspace/llm_compile/data/bailing_10B/ -cm tp serving -cfg /home/moffett/workspace/llm_compile/data/bailing_10B/bailing10b_tp_serving.json

python3 sparse_compile/gpt/llm_runtime_v3.py -mr ../llm_compile/data/20241010_bailing_10B_layer2 -w /home/moffett/workspace/llm_compile/data/bailing_10B/ -s backend

python3 moffett_software/sparse_compile/gpt/llm_runtime_v3.py -mr ../llm_compile/data/20241010_bailing_10B_layer2 -w /home/moffett/workspace/llm_compile/data/bailing_10B/ -s backend


194:
python sparse_compile/example/compile_llm_from_hf_v2.py -o debug/241010_bailing10b_real_config_test -wo /ssd3/hehuizhang/llm/weight/bailing/bailing_10B/ -hfmn /ssd3/hehuizhang/llm/weight/bailing/bailing_10B/ -cm tp serving -cfg /home/hehuizhang/git_lab/moffett_software/debug/debug_ssd3/fake_bailing/241008_bailing10b_real_config_test/bailing10b_tp_serving.json
```

2. llama3_8b
```
python3 /home/moffett/workspace/llm_compile/data/compile_llm_from_hf_v2.py -o ../llm_compile/data/20241010_llama3_8b_layer2 -wo /home/moffett/workspace/llm_compile/data/llama3_8b/ -hfmn /home/moffett/workspace/llm_compile/data/llama3_8b/ -cm tp serving 

python3 moffett_software/sparse_compile/gpt/llm_runtime_v3.py -mr ../llm_compile/data/20241010_llama3_8b_layer2 -w /home/moffett/workspace/llm_compile/data/llama3_8b/ -s backend
```


- [ ] debug_level 编译入口给，修改后测试
```
python sparse_compile/example/compile_llm_from_hf_v2.py -o /home/dongbenyang/workspace/moffett_software/debug/debug6/case/20241011_sparse_llm_llama3-8B_deliver_layer2  -
wo /ssd4/dongbenyang/llama3_8b/model -hfmn /ssd4/dongbenyang/llama3_8b/openbuddy-llama3-8b-v21.1-8k -cfg /ssd4/dongbenyang/llama3_8b/compiler_config/llama3_8b_docker_config.json -cm tp serving -dl 0
```

- [ ] 重新打镜像

1. sola-demo 修改
    - ~/workspace/git_lab/moffett_llm/sola-demo/models/glm/test/engine.py
```
def Inference(self, batches: list[TaskSlot]) -> dict:  -> 修改为 ->
def Inference(self, batches: List[TaskSlot]) -> dict:
```

    - /home/dongbenyang/workspace/git_lab/moffett_llm/sola-demo/models/glm/test/_chat_base.py
```
def run(config, args, format_question = None):

run(config, args, format_question = None)
```

2. 打镜像
```
export COMMIT_TIME=$(git show -s --format=%ci $CI_COMMIT_SHA |awk '{print $1"-"$2}' |tr -cd [:digit:] )
docker build --no-cache -t moffett_llm-20241011-$(arch):$COMMIT_TIME .
# 194
docker run -it --rm --shm-size 256g --net=host --publish-all --privileged --cap-add=ALL -v /dev:/dev -v /usr/src:/usr/src -v /lib/modules:/lib/modules -v /ssd3/dongbenyang:/home/moffett/workspace/llm_compile/data 7696af20c5db
# 105
docker run -it --rm --shm-size 256g --net=host --publish-all --privileged --cap-add=ALL  -v /dev:/dev -v /usr/src:/usr/src -v /lib/modules:/lib/modules  -v /mnt/moffett/workspace/ant/auto_compile:/home/moffett/workspace/llm_compile/data 36ce458d95a6
docker exec -it beab78904e3e /bin/bash


# bailing10b 编译
python3 /home/moffett/workspace/llm_compile/data/compile_llm_from_hf_v2.py -o ../llm_compile/data/20241011_bailing_10B_layer2_new_deliver -wo /home/moffett/workspace/llm_compile/data/bailing_10B/ -hfmn /home/moffett/workspace/llm_compile/data/bailing_10B/ -cm tp serving -cfg /home/moffett/workspace/llm_compile/data/bailing_10B/bailing10b_tp_serving.json 

python3 /home/moffett/workspace/llm_compile/data/llm_runtime_v3.py -mr ../llm_compile/data/20241011_bailing_10B_layer2_new -w /home/moffett/workspace/llm_compile/data/bailing_10B/ -s backend




# llama3_8b 编译
python3 /home/moffett/workspace/llm_compile/data/compile_llm_from_hf_v2.py -o ../llm_compile/data/20241011_llama3_8b_layer2_new -wo /home/moffett/workspace/llm_compile/data/llama3_8b/ -hfmn /home/moffett/workspace/llm_compile/data/llama3_8b/ -cm tp serving 

python3 moffett_software/sparse_compile/gpt/llm_runtime_v3.py -mr ../llm_compile/data/20241010_llama3_8b_layer2 -w /home/moffett/workspace/llm_compile/data/llama3_8b/ -s backend
```


ossutil64 cp /ssd6/dongbenyang/sparse_llm/moffett_software.tar.gz oss://moffett-oss-bucket01/Ali/antgroup/moffett_llm/
ossutil64 cp /ssd6/dongbenyang/sparse_llm/moffett_software_source.tar.gz oss://moffett-oss-bucket01/Ali/antgroup/moffett_llm/


wget http://moffett-oss-bucket01.oss-cn-shenzhen.aliyuncs.com/Ali/antgroup/moffett_llm/moffett_software.tar.gz
wget http://moffett-oss-bucket01.oss-cn-shenzhen.aliyuncs.com/Ali/antgroup/moffett_llm/moffett_software_source.tar.gz
